[{"permalink":"//","layout":"default","title":null,"content":"Página Proyectos De Administración de Sistemas Operativos de José Juan ","dir":"/","name":"README.md","path":"README.md","url":"/"},{"sort":1,"layout":"default","title":"COMPILACION DE UN KERNEL LINUX A MEDIDA","content":"<h1 id=\"compilacion-de-un-kernel-linux-a-medida\">COMPILACION DE UN KERNEL LINUX A MEDIDA</h1>\n\n<h2 id=\"introducción\">Introducción</h2>\n\n<p>En este apartado descargaremos una versión de kernel desde la página https://kernel.org/ y haremos lo siguiente:</p>\n\n<ul>\n <li>\n <p>Instalar dependencias</p>\n </li>\n <li>\n <p>Descargar Kernel</p>\n </li>\n <li>\n <p>Compilar Kernel</p>\n </li>\n <li>\n <p>Crear imagen .deb</p>\n </li>\n <li>\n <p>Instalar archivo .deb creado anteriormente</p>\n </li>\n <li>\n <p>Reducir módulos del Kernel</p>\n </li>\n</ul>\n\n<p>La versión de Kernel que he elegido para este apartado es la versión 6.0.7.</p>\n\n<h2 id=\"instalar-dependencias\">Instalar Dependencias</h2>\n\n<hr />\n\n<p>En este punto lo primero que haremos será instalar los paquetes necesarios para poder compilar el kernel y posteriormente crear el fichero .deb correspondiente.</p>\n\n<p>Primero actualizamos:</p>\n\n<div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>joseju@debian:~<span class=\"nv\">$ </span><span class=\"nb\">sudo </span>apt update\n</code></pre>  </div></div>\n\n<p>Instalamos las dependencias:</p>\n<div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>joseju@debian:~<span class=\"nv\">$ </span><span class=\"nb\">sudo </span>apt <span class=\"nb\">install </span>build-essential qtbase5-dev libelf-dev pkg-config    \n</code></pre>  </div></div>\n\n<hr />\n\n<h2 id=\"descargar-kernel\">Descargar Kernel</h2>\n\n<hr />\n\n<p>Una vez hemos instalado las correspondientes dependencias, descargaremos el archivo del kernel:</p>\n\n<div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>joseju@debian:~/compilacion_kernel<span class=\"nv\">$ </span>wget https://mirrors.edge.kernel.org/pub/linux/kernel/v6.x/linux-6.0.7.tar.xz\n</code></pre>  </div></div>\n\n<p>—Reducir módulos del Kernel</p>\n\n<p>joseju@debian:~/compilacion_kernel$ tar -xvf linux-6.0.7.tar.xz</p>\n<div class=\"language-plaintext highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>\nPosteriormente, accedemos a la carpeta y compilamos el archivo oldconfig:\n\n```shell\njoseju@debian:~/compilacion_kernel/linux-6.0.7$ make oldconfig\n</code></pre>  </div></div>\n<ul>\n <li>Al compilarlo nos hará muchas preguntas, dejamos pulsado intro ya que por defecto indicamos que no.</li>\n</ul>\n\n<p>Una vez hecho esto, se nos habrá generado un fichero oculto llamado .config:</p>\n\n<div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>usuario@debian:~/compilacion_kernel/linux-6.0.7<span class=\"nv\">$ </span><span class=\"nb\">ls</span> <span class=\"nt\">-la</span> | egrep <span class=\"s1\">'.config'</span>\n<span class=\"nt\">-rw-r--r--</span>   1 usuario usuario     59 nov  3 16:00 .cocciconfig\n<span class=\"nt\">-rw-r--r--</span>   1 usuario usuario 252431 nov 17 14:12 .config\n<span class=\"nt\">-rw-r--r--</span>   1 usuario usuario    555 nov  3 16:00 Kconfig\n</code></pre>  </div></div>\n\n<p>En este fichero se almacenan los módulos que vienen por defecto y que posteriormente deberemos ir desactivando, pero este no es el caso, asi que prodeceremos a compilar este archivo para reducir módulos automáticamente:</p>\n\n<div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>usuario@debian:~/compilacion_kernel/linux-6.0.7<span class=\"nv\">$ </span>make localmodconfig\n</code></pre>  </div></div>\n\n<hr />\n\n<h2 id=\"crear-imagen-deb\">Crear imagen .deb</h2>\n\n<hr />\n\n<p>Ahora que hemos reducido los módulos, procederemos a generar nuestra imagen .deb del kernel, para ello:</p>\n\n<div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>usuario@debian:~/compilacion_kernel/linux-6.0.7<span class=\"nv\">$ </span>make <span class=\"nt\">-j12</span> bindeb-pkg\n</code></pre>  </div></div>\n\n<ul>\n <li>Esto tardará un rato ya que antes de reducir considerablemente el número de módulos, se tienen que cargar los que vienen por defecto.</li>\n</ul>\n\n<hr />\n\n<h2 id=\"instalar-archivo-deb-creado-anteriormente\">Instalar archivo .deb creado anteriormente</h2>\n\n<hr />\n\n<p>Primero, verificamos la versión del kernel que tenemos actualmente en funcionamiento:</p>\n\n<div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>usuario@debian:~<span class=\"nv\">$ </span><span class=\"nb\">uname</span> <span class=\"nt\">-r</span>\n5.10.0-18-amd64\n</code></pre>  </div></div>\n\n<p>Ahora que hemos compilado y generado el fichero .deb, procederemos a instalar el fichero .deb que se nos ha generado y este se añadirá al grub como una nueva versión de kernel._</p>\n\n<div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>usuario@debian:~/compilacion_kernel/linux-6.0.7<span class=\"nv\">$ </span><span class=\"nb\">sudo </span>dpkg <span class=\"nt\">-i</span> ../linux-image-6.0.7_6.0.7-1_amd64.deb\n</code></pre>  </div></div>\n\n<p>En este punto reiniciamos la máquina y comprobamos que la nueva versión del kernel funciona correctmente</p>\n\n<div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>usuario@debian:~<span class=\"nv\">$ </span><span class=\"nb\">sudo </span>reboot\n</code></pre>  </div></div>\n\n<hr />\n\n<h2 id=\"reducir-módulos-del-kernel\">Reducir módulos del Kernel</h2>\n\n<hr />\n\n<p>Primero, comprobamos la versión de kernel actual tras el reinicio:</p>\n\n<div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>usuario@debian:~<span class=\"nv\">$ </span><span class=\"nb\">uname</span> <span class=\"nt\">-r</span>\n6.0.7\n</code></pre>  </div></div>\n\n<p>Ahora que tenemos cargada la nueva versión de kernel en nuestro sistema operativo, debemos reducir el número de módulos a medida de las características del hardware de nuestro equipo.</p>\n\n<p>Por ejemplo nuestro equipo funciona con un procesador intel, pues los módulos que sean amd los podemos desactivar.</p>\n\n<p>Antes de editar los módulos, comprobamos los módulos que tiene actualmente el fichero .config:</p>\n\n<div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>usuario@debian:~/compilacion_kernel/linux-6.0.7<span class=\"nv\">$ </span>egrep <span class=\"s1\">'=y'</span> .config | <span class=\"nb\">wc</span> <span class=\"nt\">-l</span>\n1627\nusuario@debian:~/compilacion_kernel/linux-6.0.7<span class=\"nv\">$ </span>egrep <span class=\"s1\">'=m'</span> .config | <span class=\"nb\">wc</span> <span class=\"nt\">-l</span>\n193\n</code></pre>  </div></div>\n\n<p>Para editar los módulos del kernel ejecutamos el siguiente comando:</p>\n\n<div class=\"language-shell highlighter-rouge\"><div class=\"highlight\"><pre class=\"highlight\"><code>usuario@debian:~/compilacion_kernel/linux-6.0.7<span class=\"nv\">$ </span>make xconfig\n</code></pre>  </div></div>\n\n<p>Nos aparecerá una ventana gráfica donde deberemos ir desmarcando los módulos que sean necesarios.</p>\n","dir":"/test/","name":"compilacion-kernel.md","path":"test/compilacion-kernel.md","url":"/test/compilacion-kernel.html"}]